{"ast":null,"code":"import React,{useEffect,useState}from'react';import axios from'axios';import{useNavigate}from'react-router-dom';import{useSelector}from'react-redux';import'./adminPanel.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const AdminPanel=()=>{const[pendingPosts,setPendingPosts]=useState([]);const navigate=useNavigate();// const token = localStorage.getItem('token'); \n// const storedUser = JSON.parse(localStorage.getItem('user')); \nconst{error,isAuthenticated,user}=useSelector(state=>state.auth);useEffect(()=>{if(!isAuthenticated||!user){alert('You are not authenticated!');navigate('/login');// Redirect to login\nreturn;}if(user.role!=='admin'){alert('Access Denied: Admins only');navigate('/');// Redirect to home\nreturn;}const fetchPendingPosts=async()=>{try{const token=localStorage.getItem('token');// Get the token from localStorage\nif(!token){throw new Error('No token found');}console.log('Token:',token);// Log the token for debugging\nconst response=await axios.get('https://rushikersclub-web-git-gh-pages-chathura-chandrasiris-projects.vercel.app/api/v1/magazine/pending',{headers:{Authorization:\"Bearer \".concat(token)// Include the token in the request headers\n},withCredentials:true});console.log('Response:',response);// Log the response for debugging\nsetPendingPosts(response.data.pendingPosts);}catch(error){console.error('Error fetching pending posts:',error);if(error.response){console.error('Error response data:',error.response.data);console.error('Error response status:',error.response.status);console.error('Error response headers:',error.response.headers);alert('Failed to fetch pending posts. Please try again.');}}};fetchPendingPosts();},[error,isAuthenticated,user,navigate]);const handleApprove=async id=>{try{const token=localStorage.getItem('token');// Get the token from localStorage\nif(!token){throw new Error('No token found');}await axios.put(\"https://rushikersclub-web-git-gh-pages-chathura-chandrasiris-projects.vercel.app/api/v1/magazine/approve/\".concat(id),{},{headers:{Authorization:\"Bearer \".concat(token)// Include the token in the request headers\n},withCredentials:true});setPendingPosts(pendingPosts.filter(post=>post._id!==id));alert('Post approved successfully.');}catch(error){console.error('Error approving post:',error);alert('Approval failed.');}};return/*#__PURE__*/_jsxs(\"div\",{className:\"admin-panel\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Pending Posts\"}),/*#__PURE__*/_jsx(\"div\",{className:\"pending-posts-grid\",children:pendingPosts.map(post=>/*#__PURE__*/_jsxs(\"div\",{className:\"post-card\",children:[/*#__PURE__*/_jsx(\"img\",{src:post.image,alt:post.title}),/*#__PURE__*/_jsxs(\"div\",{className:\"post-content\",children:[/*#__PURE__*/_jsx(\"h3\",{children:post.title}),/*#__PURE__*/_jsx(\"p\",{children:post.description}),/*#__PURE__*/_jsx(\"button\",{className:\"approve-button\",onClick:()=>handleApprove(post._id),children:\"Approve\"})]})]},post._id))})]});};export default AdminPanel;","map":{"version":3,"names":["React","useEffect","useState","axios","useNavigate","useSelector","jsx","_jsx","jsxs","_jsxs","AdminPanel","pendingPosts","setPendingPosts","navigate","error","isAuthenticated","user","state","auth","alert","role","fetchPendingPosts","token","localStorage","getItem","Error","console","log","response","get","headers","Authorization","concat","withCredentials","data","status","handleApprove","id","put","filter","post","_id","className","children","map","src","image","alt","title","description","onClick"],"sources":["C:/Github/rushikersclub-web/frontend/src/components/AdminPanel/adminPanel.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport axios from 'axios';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useSelector } from 'react-redux';\r\nimport './adminPanel.css';\r\n\r\nconst AdminPanel = () => {\r\n  const [pendingPosts, setPendingPosts] = useState([]);\r\n  const navigate = useNavigate();\r\n  // const token = localStorage.getItem('token'); \r\n  // const storedUser = JSON.parse(localStorage.getItem('user')); \r\n  const { error, isAuthenticated, user} = useSelector((state) => state.auth);\r\n  \r\n\r\n  useEffect(() => {\r\n    if (!isAuthenticated || !user) {\r\n      alert('You are not authenticated!');\r\n      navigate('/login'); // Redirect to login\r\n      return;\r\n    }\r\n\r\n    if (user.role !== 'admin') {\r\n      alert('Access Denied: Admins only');\r\n      navigate('/'); // Redirect to home\r\n      return;\r\n    }\r\n\r\n        const fetchPendingPosts = async () => {\r\n      try {\r\n        const token = localStorage.getItem('token'); // Get the token from localStorage\r\n        if (!token) {\r\n          throw new Error('No token found');\r\n        }\r\n\r\n        console.log('Token:', token); // Log the token for debugging\r\n\r\n        const response = await axios.get('https://rushikersclub-web-git-gh-pages-chathura-chandrasiris-projects.vercel.app/api/v1/magazine/pending', {\r\n          headers: {\r\n            Authorization: `Bearer ${token}`, // Include the token in the request headers\r\n          },\r\n          withCredentials: true,\r\n        });\r\n\r\n        console.log('Response:', response); // Log the response for debugging\r\n\r\n        setPendingPosts(response.data.pendingPosts);\r\n      } catch (error) {\r\n        console.error('Error fetching pending posts:', error);\r\n        if (error.response) {\r\n          console.error('Error response data:', error.response.data);\r\n          console.error('Error response status:', error.response.status);\r\n          console.error('Error response headers:', error.response.headers);\r\n          alert('Failed to fetch pending posts. Please try again.');\r\n        }\r\n      }\r\n    };\r\n    fetchPendingPosts();\r\n  }, [error, isAuthenticated, user, navigate]);\r\n\r\n  const handleApprove = async (id) => {\r\n    try {\r\n      const token = localStorage.getItem('token'); // Get the token from localStorage\r\n      if (!token) {\r\n        throw new Error('No token found');\r\n      }\r\n\r\n      await axios.put(`https://rushikersclub-web-git-gh-pages-chathura-chandrasiris-projects.vercel.app/api/v1/magazine/approve/${id}`, {}, {\r\n        headers: {\r\n          Authorization: `Bearer ${token}`, // Include the token in the request headers\r\n        },\r\n        withCredentials: true,\r\n      }\r\n      \r\n    );\r\n\r\n      setPendingPosts(pendingPosts.filter(post => post._id !== id));\r\n      alert('Post approved successfully.');\r\n    } catch (error) {\r\n      console.error('Error approving post:', error);\r\n      alert('Approval failed.');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"admin-panel\">\r\n      <h2>Pending Posts</h2>\r\n      <div className=\"pending-posts-grid\">\r\n        {pendingPosts.map(post => (\r\n          <div key={post._id} className=\"post-card\">\r\n            <img src={post.image} alt={post.title} />\r\n            <div className=\"post-content\">\r\n              <h3>{post.title}</h3>\r\n              <p>{post.description}</p>\r\n              <button className=\"approve-button\" onClick={() => handleApprove(post._id)}>\r\n                Approve\r\n              </button>\r\n            </div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AdminPanel;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}